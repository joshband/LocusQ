<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LocusQ</title>
  <script>
    window.__LQ_BOOT_ERRORS__ = [];
    window.addEventListener("error", function (event) {
      var message = "unknown";
      if (event && event.message) message = event.message;
      else if (event && event.error) message = String(event.error);
      window.__LQ_BOOT_ERRORS__.push(message);
    });
  </script>
  <script defer src="js/three.min.js"></script>
  <script defer src="js/juce/check_native_interop.js"></script>
  <script defer src="js/juce/index.js"></script>
  <script defer src="js/index.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0A0A0A;
      --surface: #141414;
      --surface-elevated: #1E1E1E;
      --border: #2A2A2A;
      --gold: #D4A847;
      --gold-bright: #E8C464;
      --gold-dim: #8B7234;
      --text-primary: #E0E0E0;
      --text-secondary: #AAAAAA;
      --text-dim: #666666;
      --text-warning: #AA4444;
      --text-success: #44AA66;
      --wireframe: #E0E0E0;
      --rail-width-base: 356px;
      --rail-width-compact: 308px;
      --rail-width-tight: 288px;
      --rail-width: var(--rail-width-base);
      --header-height: 40px;
      --timeline-height: 158px;
      --timeline-height-compact: 140px;
      --timeline-height-tight: 128px;
      --emitter-row-height: 32px;
      --emitter-section-gap: 14px;
      --emitter-inline-input-width: 148px;
      --emitter-inline-input-width-tight: 124px;
      --font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    html, body {
      width: 100%;
      height: 100%;
    }

    body {
      background: var(--bg);
      color: var(--text-primary);
      font-family: var(--font);
      width: 100%;
      height: 100%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      user-select: none;
    }
    /* Keep rail width consistent across CALIBRATE / EMITTER / RENDERER.
       Only viewport-size breakpoints change rail width. */
    body.layout-compact {
      --rail-width: var(--rail-width-compact);
    }
    body.layout-tight {
      --rail-width: var(--rail-width-tight);
    }
    body.layout-compact.mode-emitter {
      --timeline-height: var(--timeline-height-compact);
    }
    body.layout-tight.mode-emitter {
      --timeline-height: var(--timeline-height-tight);
    }

    /* ===== HEADER ===== */
    .header {
      height: var(--header-height);
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 16px;
      gap: 16px;
      flex-shrink: 0;
    }

    .logo {
      font-size: 14px; font-weight: 700;
      letter-spacing: 2px; color: var(--gold);
    }

    .mode-tabs { display: flex; position: relative; margin-left: 8px; }

    .mode-tab {
      padding: 10px 14px;
      font-size: 11px; font-weight: 600;
      letter-spacing: 1.5px; text-transform: uppercase;
      color: var(--text-dim);
      cursor: pointer; border: none; background: none;
      position: relative; transition: color 200ms;
    }
    .mode-tab.active { color: var(--text-primary); }
    .mode-tab.active::after {
      content: '';
      position: absolute;
      bottom: 0; left: 14px; right: 14px;
      height: 2px; background: var(--gold); border-radius: 1px;
    }
    .mode-tab:hover:not(.active) { color: var(--text-secondary); }

    .header-spacer { flex: 1; }

    .scene-status {
      font-size: 9px; font-weight: 600;
      letter-spacing: 1.5px; text-transform: uppercase;
      padding: 3px 8px; border-radius: 9px;
      border: 1px solid rgba(170,170,170,0.2);
      color: var(--text-secondary);
      transition: all 200ms;
    }
    .scene-status.physics { color: var(--gold); border-color: rgba(212,168,71,0.3); animation: statusPulse 1s ease infinite; }
    .scene-status.measuring { color: var(--gold); border-color: rgba(212,168,71,0.3); animation: statusPulse 1s ease infinite; }
    .scene-status.ready { color: var(--text-success); border-color: rgba(68,170,102,0.3); }
    .scene-status.noprofile { color: var(--text-warning); border-color: rgba(170,68,68,0.3); }
    .scene-status.stale { color: var(--text-warning); border-color: rgba(212,168,71,0.4); animation: statusPulse 1.2s ease infinite; }
    .viewport-lock {
      font-size: 9px;
      font-weight: 600;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      color: var(--text-dim);
      border: 1px solid rgba(102,102,102,0.25);
      border-radius: 9px;
      padding: 3px 8px;
    }

    @keyframes statusPulse {
      0%, 100% { border-color: rgba(212,168,71,0.15); }
      50% { border-color: rgba(212,168,71,0.35); }
    }

    .room-profile {
      font-size: 11px;
      display: flex; align-items: center; gap: 6px;
    }
    .room-profile .dot { width: 6px; height: 6px; border-radius: 50%; }
    .room-profile .dot.loaded { background: var(--text-success); }
    .room-profile .dot.none { background: var(--text-dim); }

    .quality-badge {
      font-size: 10px; font-weight: 600;
      letter-spacing: 1px; text-transform: uppercase;
      padding: 4px 10px; border-radius: 3px;
      cursor: pointer; transition: all 150ms;
    }
    .quality-badge.draft { border: 1px solid var(--text-dim); color: var(--text-secondary); background: transparent; }
    .quality-badge.final { border: 1px solid var(--gold); color: #0A0A0A; background: var(--gold); }

    /* ===== MAIN ===== */
    .main { display: flex; flex: 1; overflow: hidden; min-width: 0; }

    .viewport-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      min-height: 0;
      min-width: 0;
    }
    #viewport-canvas {
      flex: 1 1 auto;
      min-height: 0;
      display: block;
      position: relative;
      z-index: 0;
    }

    .view-buttons { position: absolute; top: 8px; left: 8px; display: flex; gap: 4px; }
    .view-btn {
      width: 28px; height: 28px;
      background: rgba(20,20,20,0.8);
      border: 1px solid var(--border); border-radius: 4px;
      color: var(--text-dim); font-size: 10px; font-weight: 600;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 150ms;
    }
    .view-btn:hover { color: var(--text-primary); border-color: var(--text-dim); }
    .view-btn.active { color: var(--gold); border-color: var(--gold-dim); }

    .viewport-overlay {
      position: absolute; bottom: 12px; left: 12px;
      font-size: 11px; color: var(--text-dim);
      pointer-events: none;
    }
    .viewport-area.timeline-visible .viewport-overlay {
      bottom: calc(var(--timeline-height) + 12px);
    }

    /* ===== TIMELINE ===== */
    .timeline {
      height: 0; background: var(--surface);
      border-top: 1px solid var(--border);
      overflow: hidden; transition: height 200ms ease-out;
      position: relative;
      z-index: 2;
    }
    .timeline.visible { height: var(--timeline-height, 152px); }
    .viewport-area > .timeline > .timeline-header { display: flex !important; min-height: 28px; }
    .viewport-area > .timeline > .timeline-lanes { display: block !important; }

    .timeline-header {
      height: 28px; display: flex; align-items: center;
      padding: 0 12px; gap: 12px;
      border-bottom: 1px solid var(--border);
    }
    .timeline-transport { display: flex; gap: 4px; align-items: center; }
    .transport-btn {
      width: 20px; height: 20px;
      background: none; border: 1px solid var(--border); border-radius: 3px;
      color: var(--text-dim); font-size: 9px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
    }
    .transport-btn:hover { color: var(--text-primary); }

    .timeline-time {
      font-size: 11px; font-weight: 500;
      color: var(--text-secondary);
      font-variant-numeric: tabular-nums;
    }

    .timeline-toggle-label {
      font-size: 10px; color: var(--text-dim);
      display: flex; align-items: center; gap: 4px;
    }

    .timeline-lanes {
      height: calc(var(--timeline-height, 152px) - 28px);
      min-height: 96px;
      padding: 4px 12px 6px;
      overflow-y: auto;
      overflow-x: hidden;
    }
    .timeline-lanes::-webkit-scrollbar { width: 4px; }
    .timeline-lanes::-webkit-scrollbar-track { background: transparent; }
    .timeline-lanes::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.12); border-radius: 2px; }
    .timeline-lane {
      display: flex; align-items: center;
      height: 24px; gap: 8px;
      cursor: pointer; border-radius: 3px;
      padding: 0 4px; transition: background 100ms;
    }
    .timeline-lane:hover { background: rgba(42,42,42,0.5); }
    .timeline-lane.selected { background: rgba(212,168,71,0.08); }

    .lane-label {
      font-size: 10px; color: var(--text-dim);
      width: 60px; text-align: right;
      transition: color 150ms;
    }
    .timeline-lane.selected .lane-label { color: var(--gold); }

    .lane-track {
      flex: 1;
      height: 14px;
      background:
        linear-gradient(to bottom, rgba(255,255,255,0.03), rgba(0,0,0,0.0)),
        linear-gradient(to right, rgba(200,200,200,0.05), rgba(200,200,200,0.02));
      border: 1px solid rgba(255,255,255,0.05);
      position: relative;
      border-radius: 2px;
    }
    .keyframe-dot {
      position: absolute;
      width: 10px; height: 10px;
      background: var(--gold); border-radius: 50%;
      transform: translate(-5px, -5px);
      cursor: pointer;
      border: 1px solid rgba(12, 12, 12, 0.8);
      box-shadow: 0 0 0 1px rgba(212,168,71,0.35);
      z-index: 2;
    }
    .keyframe-dot:hover {
      background: var(--gold-bright);
      transform: translate(-5px, -5px) scale(1.15);
    }
    .keyframe-dot.dragging {
      transform: translate(-5px, -5px) scale(1.2);
      box-shadow: 0 0 0 1px rgba(212,168,71,0.8);
      z-index: 4;
    }
    .timeline-playhead {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 1px;
      background: rgba(212,168,71,0.85);
      box-shadow: 0 0 6px rgba(212,168,71,0.5);
      pointer-events: none;
      z-index: 1;
    }
    .curve-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 24px;
      height: 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-secondary);
      font-size: 9px;
      padding: 0 6px;
      letter-spacing: 0.2px;
    }

    /* ===== RAIL ===== */
    .rail {
      width: var(--rail-width);
      background: var(--surface);
      border-left: 1px solid var(--border);
      padding-right: 6px;
      overflow-y: auto; overflow-x: hidden;
      flex-shrink: 0;
      transition: width 180ms ease;
      scrollbar-gutter: stable;
    }
    .rail::-webkit-scrollbar { width: 4px; }
    .rail::-webkit-scrollbar-track { background: transparent; }
    .rail::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

    .rail-mode-label {
      padding: 12px 12px 8px;
      font-size: 10px; font-weight: 600;
      letter-spacing: 1.2px; text-transform: uppercase;
      color: var(--text-dim);
    }

    .section { padding: 0 12px 12px; }
    .section-header {
      font-size: 10px; font-weight: 600;
      letter-spacing: 1.2px; text-transform: uppercase;
      color: var(--text-dim);
      padding: 12px 0 8px;
      border-top: 1px solid var(--border);
    }

    .rail-panel[data-panel="emitter"] {
      padding-bottom: 12px;
    }
    .rail-panel[data-panel="emitter"] .rail-mode-label {
      padding: 10px 12px 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .emitter-panel {
      display: flex;
      flex-direction: column;
      gap: var(--emitter-section-gap);
      padding: 0 10px;
    }
    .emitter-card {
      padding: 0 10px 10px;
      border: 1px solid rgba(212, 168, 71, 0.12);
      border-radius: 8px;
      background: rgba(18, 18, 18, 0.65);
    }
    .emitter-card .section {
      padding: 0;
    }
    .emitter-card .section-header {
      border-top: none;
      padding: 10px 0 8px;
      font-size: 11px;
      letter-spacing: 1.1px;
    }
    .rail-panel[data-panel="emitter"] .control-row {
      min-height: var(--emitter-row-height);
    }
    .motion-chip-row {
      padding: 0 12px 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .emitter-authority-note {
      margin: -4px 12px 2px;
      padding: 5px 8px;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(255, 255, 255, 0.02);
      color: var(--text-dim);
      font-size: 9px;
      letter-spacing: 0.6px;
      text-transform: uppercase;
    }
    .emitter-authority-note.locked {
      border-color: rgba(212, 168, 71, 0.36);
      background: rgba(212, 168, 71, 0.08);
      color: var(--gold);
    }
    .status-chip {
      font-size: 9px;
      font-weight: 600;
      letter-spacing: 0.9px;
      text-transform: uppercase;
      padding: 3px 8px;
      border-radius: 9px;
      border: 1px solid rgba(160, 160, 160, 0.22);
      color: var(--text-secondary);
      background: rgba(24, 24, 24, 0.7);
      white-space: nowrap;
    }
    .status-chip.active {
      border-color: rgba(212, 168, 71, 0.45);
      color: var(--gold);
      background: rgba(212, 168, 71, 0.12);
    }
    .status-chip.warning {
      border-color: rgba(212, 168, 71, 0.42);
      color: var(--gold);
    }
    .status-chip.local {
      border-color: rgba(68, 170, 102, 0.45);
      color: var(--text-success);
      background: rgba(68, 170, 102, 0.1);
    }
    .status-chip.remote {
      border-color: rgba(212, 168, 71, 0.42);
      color: var(--gold);
      background: rgba(212, 168, 71, 0.12);
    }
    .rail-panel[data-panel="calibrate"] {
      padding-bottom: 12px;
    }
    .rail-panel[data-panel="calibrate"] .rail-mode-label {
      padding: 10px 12px 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .cal-chip-row {
      padding: 0 12px 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .calibrate-panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 0 10px;
    }
    .cal-card {
      padding: 0 10px 10px;
      border: 1px solid rgba(122, 175, 201, 0.2);
      border-radius: 8px;
      background: rgba(16, 18, 22, 0.62);
    }
    .cal-card .section {
      padding: 0;
    }
    .cal-card .section-header {
      border-top: none;
      padding: 10px 0 8px;
      font-size: 11px;
      letter-spacing: 1.1px;
    }
    .cal-card .control-row {
      min-height: 30px;
    }
    .cal-mapping-matrix {
      display: grid;
      gap: 4px;
      margin-top: 4px;
      max-height: 212px;
      overflow-y: auto;
      padding-right: 2px;
    }
    .cal-mapping-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      min-height: 28px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 5px;
      padding: 0 8px;
      background: rgba(255, 255, 255, 0.02);
    }
    .cal-mapping-row.readonly {
      opacity: 0.65;
      border-color: rgba(255, 255, 255, 0.08);
    }
    .cal-mapping-row .control-label {
      font-size: 10px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    .cal-mapping-row .dropdown {
      min-width: 84px;
    }
    .cal-mapping-row .control-value {
      font-size: 10px;
      color: var(--text-dim);
    }
    .cal-mapping-note {
      font-size: 10px;
      color: var(--text-dim);
      line-height: 1.3;
      padding-top: 4px;
    }
    .cal-mapping-note.warning {
      color: var(--gold);
    }
    .cal-validation-list {
      display: grid;
      gap: 6px;
      padding-top: 6px;
    }
    .cal-diagnostic-card {
      border: 1px solid rgba(122, 175, 201, 0.2);
      border-radius: 6px;
      padding: 6px 7px;
      background: rgba(255, 255, 255, 0.03);
      transition: border-color 120ms ease, background-color 120ms ease;
    }
    .cal-diagnostic-card[data-state="pass"] {
      border-color: rgba(68, 170, 102, 0.35);
      background: rgba(68, 170, 102, 0.08);
    }
    .cal-diagnostic-card[data-state="fail"] {
      border-color: rgba(170, 68, 68, 0.35);
      background: rgba(170, 68, 68, 0.1);
    }
    .cal-diagnostic-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      min-height: 18px;
    }
    .cal-diagnostic-label {
      font-size: 10px;
      letter-spacing: 0.45px;
      color: var(--text-secondary);
      text-transform: uppercase;
      line-height: 1.25;
    }
    .cal-diagnostic-card .status-chip {
      font-size: 8px;
      padding: 2px 7px;
    }
    .cal-diagnostic-card .status-chip.pass {
      border-color: rgba(68, 170, 102, 0.42);
      color: var(--text-success);
      background: rgba(68, 170, 102, 0.12);
    }
    .cal-diagnostic-card .status-chip.fail {
      border-color: rgba(170, 68, 68, 0.42);
      color: #ffb2b2;
      background: rgba(170, 68, 68, 0.16);
    }
    .cal-diagnostic-card .status-chip.untested {
      border-color: rgba(212, 168, 71, 0.42);
      color: var(--gold);
      background: rgba(212, 168, 71, 0.12);
    }
    .cal-diagnostic-detail {
      font-size: 9px;
      color: var(--text-dim);
      line-height: 1.3;
      margin-top: 4px;
      min-height: 12px;
    }
    .cal-profile-name-row {
      gap: 8px;
    }
    .cal-profile-name-row .text-input {
      min-width: 120px;
    }
    .cal-profile-actions {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      padding-top: 6px;
    }
    .cal-profile-actions .btn-secondary {
      flex: 1 1 calc(50% - 3px);
      min-width: 0;
      padding: 5px 8px;
      font-size: 10px;
    }
    .cal-profile-status {
      font-size: 10px;
      color: var(--text-secondary);
      min-height: 14px;
      padding-top: 4px;
    }
    .cal-profile-status.error {
      color: #ffb2b2;
    }
    .cal-ack-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding-top: 4px;
    }
    .cal-ack-label {
      font-size: 10px;
      color: var(--text-dim);
    }
    .cal-ack-check {
      transform: scale(0.95);
      accent-color: var(--gold);
    }
    .emitter-card.authority-readonly {
      border-color: rgba(160, 160, 160, 0.14);
      background: rgba(18, 18, 18, 0.52);
    }
    .emitter-card.authority-readonly .section-header {
      color: #818181;
    }
    .emitter-card.authority-readonly .control-label {
      color: #7a7a7a;
    }
    .emitter-card.authority-readonly .control-value {
      color: #939393;
    }
    .emitter-card.authority-readonly .text-input,
    .emitter-card.authority-readonly .dropdown,
    .emitter-card.authority-readonly .btn-secondary {
      opacity: 0.62;
    }
    .rail-panel[data-panel="renderer"] {
      padding-bottom: 12px;
    }
    .rail-panel[data-panel="renderer"] .rail-mode-label {
      padding: 10px 12px 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .renderer-chip-row {
      padding: 0 12px 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .renderer-fallback-note {
      margin: -4px 12px 2px;
      padding: 5px 8px;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(255, 255, 255, 0.02);
      color: var(--text-dim);
      font-size: 9px;
      letter-spacing: 0.6px;
      text-transform: uppercase;
    }
    .renderer-fallback-note.warning {
      border-color: rgba(212, 168, 71, 0.36);
      background: rgba(212, 168, 71, 0.08);
      color: var(--gold);
    }
    .renderer-panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 0 10px;
    }
    .renderer-card {
      padding: 0 10px 10px;
      border: 1px solid rgba(212, 168, 71, 0.14);
      border-radius: 8px;
      background: rgba(18, 18, 18, 0.64);
    }
    .renderer-card .section {
      padding: 0;
    }
    .renderer-card .section-header {
      border-top: none;
      padding: 10px 0 8px;
      font-size: 11px;
      letter-spacing: 1.1px;
    }
    .renderer-profile-grid {
      display: grid;
      gap: 6px;
      padding-top: 2px;
    }
    .renderer-profile-line {
      min-height: 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 5px;
      padding: 0 8px;
      background: rgba(255, 255, 255, 0.02);
    }
    .renderer-profile-label {
      font-size: 10px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      color: var(--text-dim);
    }
    .renderer-profile-value {
      font-size: 11px;
      color: var(--text-primary);
      letter-spacing: 0.2px;
      text-align: right;
    }
    .renderer-output-summary {
      font-size: 10px;
      color: var(--text-secondary);
      line-height: 1.35;
      padding-top: 6px;
    }
    .renderer-diagnostic-list {
      display: grid;
      gap: 6px;
      padding-top: 4px;
    }
    .renderer-diagnostic-card {
      border: 1px solid rgba(212, 168, 71, 0.18);
      border-radius: 6px;
      padding: 6px 7px;
      background: rgba(255, 255, 255, 0.03);
    }
    .renderer-diagnostic-card.headtracking {
      border-color: rgba(70, 212, 255, 0.32);
      background: rgba(70, 212, 255, 0.08);
    }
    .renderer-diagnostic-card.headtracking .renderer-diagnostic-label {
      color: #9adfff;
    }
    .renderer-diagnostic-card.headtracking .renderer-diagnostic-field-value.mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      letter-spacing: 0.2px;
    }
    .renderer-diagnostic-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      min-height: 18px;
    }
    .renderer-diagnostic-label {
      font-size: 10px;
      letter-spacing: 0.45px;
      color: var(--text-secondary);
      text-transform: uppercase;
      line-height: 1.25;
    }
    .renderer-diagnostic-detail {
      font-size: 9px;
      color: var(--text-dim);
      line-height: 1.3;
      margin-top: 4px;
      min-height: 12px;
      word-break: break-word;
    }
    .renderer-diagnostic-toggle {
      border: none;
      background: transparent;
      color: inherit;
      padding: 0;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      font: inherit;
    }
    .renderer-diagnostic-toggle .disclosure-arrow {
      font-size: 11px;
      transform: rotate(0deg);
      transition: transform 140ms ease;
    }
    .renderer-diagnostic-toggle .disclosure-arrow.open {
      transform: rotate(90deg);
    }
    .renderer-diagnostic-content {
      display: none;
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      gap: 4px;
    }
    .renderer-diagnostic-content.open {
      display: grid;
    }
    .renderer-diagnostic-field {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      min-height: 18px;
    }
    .renderer-diagnostic-field-label {
      font-size: 9px;
      letter-spacing: 0.45px;
      text-transform: uppercase;
      color: var(--text-dim);
    }
    .renderer-diagnostic-field-value {
      font-size: 10px;
      color: var(--text-secondary);
      text-align: right;
      word-break: break-word;
    }
    .renderer-diagnostic-field.error .renderer-diagnostic-field-value {
      color: #ffb2b2;
    }
    .renderer-card .status-chip.ok {
      border-color: rgba(68, 170, 102, 0.42);
      color: var(--text-success);
      background: rgba(68, 170, 102, 0.12);
    }
    .renderer-card .status-chip.error {
      border-color: rgba(170, 68, 68, 0.42);
      color: #ffb2b2;
      background: rgba(170, 68, 68, 0.16);
    }
    .renderer-card .status-chip.neutral {
      border-color: rgba(160, 160, 160, 0.26);
      color: var(--text-secondary);
      background: rgba(255, 255, 255, 0.04);
    }
    .motion-subsection + .motion-subsection {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
    }
    .motion-transport-strip {
      margin-top: 8px;
      margin-bottom: 8px;
      min-height: 32px;
      border: 1px solid rgba(212, 168, 71, 0.22);
      border-radius: 6px;
      background: rgba(212, 168, 71, 0.05);
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 5px 8px;
      flex-wrap: wrap;
    }
    .motion-transport-strip .timeline-transport {
      gap: 4px;
    }
    .motion-transport-strip .transport-btn {
      width: 22px;
      height: 22px;
    }
    .motion-transport-strip .timeline-time {
      min-width: 72px;
      font-size: 10px;
      color: var(--text-primary);
    }
    .motion-transport-strip .timeline-toggle-label {
      font-size: 9px;
    }
    .motion-transport-strip.inactive {
      opacity: 0.45;
      pointer-events: none;
      filter: saturate(0.45);
      border-color: rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.03);
    }
    .motion-speed-block {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-left: auto;
    }
    .motion-speed-label {
      font-size: 9px;
      letter-spacing: 0.8px;
      text-transform: uppercase;
      color: var(--text-dim);
    }
    .motion-speed-value {
      min-width: 56px;
      justify-content: flex-end;
    }
    .motion-subsection-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--text-dim);
      padding-bottom: 2px;
    }
    .motion-subsection.inactive {
      opacity: 0.42;
      pointer-events: none;
      filter: saturate(0.5);
    }
    .motion-subsection.active {
      opacity: 1.0;
      pointer-events: auto;
      filter: none;
    }
    .emitter-diagnostics-toggle {
      cursor: pointer;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .emitter-diagnostics-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 180ms ease-out;
    }
    .emitter-diagnostics-content.open {
      max-height: 140px;
    }
    .coord-group-caption {
      font-size: 9px;
      font-weight: 600;
      letter-spacing: 0.9px;
      text-transform: uppercase;
      color: var(--text-dim);
      padding: 6px 0 2px;
    }
    .coord-row.coord-inactive .control-label {
      color: #777777;
    }
    .coord-row.coord-inactive .control-value {
      color: #909090;
      opacity: 0.7;
      pointer-events: none;
      cursor: default !important;
    }
    .coord-row.coord-active .control-value {
      pointer-events: auto;
      opacity: 1.0;
    }
    .position-readback-row .control-value {
      font-size: 10px;
      color: var(--text-secondary);
      letter-spacing: 0.2px;
    }

    .control-row {
      display: flex; align-items: center;
      justify-content: space-between;
      min-height: 28px;
      gap: 10px;
    }
    .control-label {
      flex: 1 1 auto;
      min-width: 0;
      font-size: 11px;
      color: var(--text-secondary);
    }
    .control-value {
      font-size: 12px; font-weight: 500;
      font-variant-numeric: tabular-nums;
      color: var(--text-primary);
      display: flex; align-items: center; gap: 4px;
    }
    .control-unit { font-size: 10px; color: var(--text-dim); }

    .toggle {
      width: 28px; height: 14px;
      border-radius: 7px; background: var(--border);
      position: relative; cursor: pointer;
      transition: background 150ms;
    }
    .toggle.on { background: var(--gold); }
    .toggle-thumb {
      width: 10px; height: 10px; border-radius: 50%;
      background: var(--text-dim);
      position: absolute; top: 2px; left: 2px;
      transition: all 150ms;
    }
    .toggle.on .toggle-thumb { left: 16px; background: var(--text-primary); }

    .dropdown {
      background: var(--surface-elevated);
      border: 1px solid var(--border); border-radius: 4px;
      padding: 4px 8px; font-size: 11px;
      color: var(--text-primary);
      cursor: pointer; min-width: 104px;
      appearance: none; -webkit-appearance: none;
      font-family: var(--font);
      background-image: url("data:image/svg+xml,%3Csvg width='8' height='5' viewBox='0 0 8 5' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L4 4L7 1' stroke='%23666666' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 8px center;
      padding-right: 22px;
    }
    .dropdown:focus { outline: none; border-color: var(--gold-dim); }
    .dropdown:disabled {
      opacity: 0.52;
      cursor: not-allowed;
      filter: saturate(0.5);
    }
    .dropdown.wide { min-width: 120px; }

    .btn-primary {
      background: var(--gold); color: #0A0A0A;
      border: none; border-radius: 4px;
      padding: 8px 16px;
      font-size: 11px; font-weight: 600;
      letter-spacing: 0.5px;
      cursor: pointer; width: 100%;
      font-family: var(--font);
      transition: background 150ms;
    }
    .btn-primary:hover { background: var(--gold-bright); }

    .btn-secondary {
      background: transparent;
      color: var(--text-primary);
      border: 1px solid var(--border); border-radius: 4px;
      padding: 6px 12px;
      font-size: 11px; font-weight: 500;
      cursor: pointer; font-family: var(--font);
      transition: all 150ms;
    }
    .btn-secondary:hover { border-color: var(--text-dim); }
    .btn-secondary:disabled {
      opacity: 0.52;
      cursor: not-allowed;
      border-color: rgba(170, 170, 170, 0.22);
    }

    .btn-row { display: flex; gap: 8px; padding-top: 8px; }
    .btn-row .btn-secondary { flex: 1; text-align: center; }

    .scene-item {
      display: flex; align-items: center;
      gap: 8px; padding: 6px 8px;
      border-radius: 4px; cursor: pointer;
      border: 1px solid transparent;
      transition: background 150ms;
    }
    .scene-item:hover { background: var(--surface-elevated); }
    .scene-item.selected { background: rgba(212,168,71,0.10); border-color: rgba(212,168,71,0.28); }
    .scene-dot { width: 8px; height: 8px; border-radius: 50%; }
    .scene-name { flex: 1; font-size: 11px; color: var(--text-primary); }
    .scene-action-btn {
      font-size: 9px; color: var(--text-dim);
      background: none; border: 1px solid transparent;
      border-radius: 3px; padding: 2px 5px; cursor: pointer;
    }
    .scene-action-btn:hover { border-color: var(--border); color: var(--text-secondary); }

    .text-input {
      background: var(--surface-elevated);
      border: 1px solid var(--border); border-radius: 4px;
      padding: 4px 8px; font-size: 11px;
      color: var(--text-primary);
      font-family: var(--font); width: 100%;
    }
    .text-input:focus { outline: none; border-color: var(--gold-dim); }
    .text-input:disabled,
    .text-input[readonly] {
      opacity: 0.55;
      cursor: not-allowed;
      border-color: rgba(170, 170, 170, 0.22);
    }
    .emitter-inline-input {
      width: min(var(--emitter-inline-input-width), 58%);
      min-width: 104px;
    }
    [data-control-locked="1"],
    [aria-disabled="true"] {
      cursor: not-allowed !important;
      opacity: 0.5;
    }
    #emit-color-swatch[aria-disabled="true"] {
      filter: saturate(0.2);
    }

    .disclosure {
      font-size: 10px; color: var(--text-dim);
      cursor: pointer; padding: 8px 0;
      display: flex; align-items: center; gap: 6px;
      transition: color 150ms;
    }
    .disclosure:hover { color: var(--text-secondary); }
    .disclosure-arrow {
      font-size: 8px; transition: transform 150ms; display: inline-block;
    }
    .disclosure-arrow.open { transform: rotate(90deg); }
    .disclosure-content {
      max-height: 0; overflow: hidden;
      transition: max-height 200ms ease-out;
    }
    .disclosure-content.open { max-height: 300px; }

    .capture-meter {
      height: 40px; background: var(--surface-elevated);
      border-radius: 4px; margin: 8px 0;
      position: relative; overflow: hidden;
    }
    .capture-bar {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: var(--gold); opacity: 0.5;
      transition: height 80ms;
    }
    .capture-label {
      position: absolute; top: 4px; left: 8px;
      font-size: 9px; color: var(--text-dim);
      letter-spacing: 0.5px;
    }

    .rail-panel { display: none; }
    .rail-panel.active { display: block; }

    body.layout-compact .emitter-panel {
      gap: 10px;
      padding: 0 8px;
    }
    body.layout-tight .emitter-panel {
      gap: 8px;
      padding: 0 6px;
    }
    body.layout-tight .emitter-card {
      padding: 0 8px 8px;
    }
    body.layout-tight .motion-chip-row {
      padding: 0 10px 8px;
      gap: 4px;
    }
    body.layout-tight .status-chip {
      font-size: 8px;
      letter-spacing: 0.6px;
      padding: 2px 6px;
    }
    body.layout-tight .dropdown.wide {
      min-width: 104px;
    }
    body.layout-tight .emitter-inline-input {
      width: min(var(--emitter-inline-input-width-tight), 56%);
      min-width: 88px;
    }
    body.layout-tight .rail-panel[data-panel="emitter"] .btn-row {
      gap: 6px;
      flex-wrap: wrap;
    }
    body.layout-tight .rail-panel[data-panel="emitter"] .btn-row .btn-secondary {
      flex: 1 1 calc(50% - 3px);
      min-width: 0;
      padding: 5px 8px;
      font-size: 10px;
    }
    body.layout-tight .emitter-authority-note {
      margin: -2px 10px 2px;
      padding: 4px 6px;
      font-size: 8px;
      letter-spacing: 0.45px;
    }
    body.layout-tight .timeline-header {
      gap: 8px;
      padding: 0 8px;
    }
    body.layout-tight .lane-label {
      width: 52px;
      font-size: 9px;
    }
    body.layout-compact .rail-panel[data-panel="calibrate"] .calibrate-panel {
      gap: 8px;
      padding: 0 8px;
    }
    body.layout-tight .rail-panel[data-panel="calibrate"] .cal-chip-row {
      padding: 0 10px 8px;
      gap: 4px;
    }
    body.layout-tight .rail-panel[data-panel="calibrate"] .calibrate-panel {
      gap: 8px;
      padding: 0 6px;
    }
    body.layout-tight .rail-panel[data-panel="calibrate"] .cal-card {
      padding: 0 8px 8px;
    }
    body.layout-tight .rail-panel[data-panel="calibrate"] .control-row {
      min-height: 28px;
      gap: 6px;
      flex-wrap: wrap;
      align-items: flex-start;
    }
    body.layout-tight .rail-panel[data-panel="calibrate"] .control-label {
      font-size: 10px;
    }
    body.layout-tight .rail-panel[data-panel="calibrate"] .dropdown.wide {
      min-width: 102px;
      width: 100%;
    }
    body.layout-tight .rail-panel[data-panel="calibrate"] .cal-profile-actions .btn-secondary {
      flex: 1 1 100%;
    }
    body.layout-tight .rail-panel[data-panel="calibrate"] .cal-diagnostic-header {
      align-items: flex-start;
      gap: 6px;
    }
    body.layout-tight .rail-panel[data-panel="calibrate"] .cal-diagnostic-detail {
      font-size: 8px;
    }
    body.layout-tight .renderer-panel {
      gap: 8px;
      padding: 0 6px;
    }
    body.layout-tight .renderer-card {
      padding: 0 8px 8px;
    }
    body.layout-tight .renderer-chip-row {
      padding: 0 10px 8px;
      gap: 4px;
    }
    body.layout-tight .renderer-fallback-note {
      margin: -2px 10px 2px;
      padding: 4px 6px;
      font-size: 8px;
      letter-spacing: 0.45px;
    }

    .status-row { display: flex; align-items: center; gap: 6px; padding: 3px 0; }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--text-dim); }
    .status-dot.complete { background: var(--text-success); }
    .status-dot.active { background: var(--gold); animation: pulse 1s ease infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    .status-text { font-size: 11px; color: var(--text-secondary); }
  </style>
</head>
<body class="mode-emitter">

  <!-- HEADER -->
  <div class="header">
    <div class="logo">LOCUSQ</div>
    <div class="mode-tabs">
      <button class="mode-tab" data-mode="calibrate">Calibrate</button>
      <button class="mode-tab active" data-mode="emitter">Emitter</button>
      <button class="mode-tab" data-mode="renderer">Renderer</button>
    </div>
    <div class="header-spacer"></div>
    <div class="scene-status" id="scene-status">STABLE</div>
    <div class="viewport-lock" id="viewport-lock">VIEWPORT LOCK</div>
    <div class="room-profile">
      <span class="dot none" id="room-dot"></span>
      <span style="color: var(--text-secondary); font-size: 11px;" id="room-label">No Profile</span>
    </div>
    <div class="quality-badge draft" id="quality-badge">DRAFT</div>
  </div>

  <!-- MAIN -->
  <div class="main">
    <div class="viewport-area timeline-visible">
      <canvas id="viewport-canvas"></canvas>

      <div class="view-buttons">
        <button class="view-btn active" data-view="perspective" title="Perspective">P</button>
        <button class="view-btn" data-view="top" title="Top Down">T</button>
        <button class="view-btn" data-view="front" title="Front">F</button>
        <button class="view-btn" data-view="side" title="Side">S</button>
      </div>

      <div class="viewport-overlay" id="viewport-info">Emitter Mode &middot; 0 objects</div>

      <!-- TIMELINE (Emitter mode only) -->
      <div class="timeline visible" id="timeline">
        <div class="timeline-header">
          <div class="timeline-transport">
            <button class="transport-btn" id="timeline-rewind-btn" title="Rewind to start and pause">&#9664;</button>
            <button class="transport-btn" id="timeline-stop-btn" title="Stop at current time">&#9632;</button>
            <button class="transport-btn" id="timeline-play-btn" title="Play from current time">&#9654;</button>
          </div>
          <span class="timeline-time" id="timeline-time">00:00.000</span>
          <div class="header-spacer"></div>
          <div class="timeline-toggle-label">Loop <div class="toggle" id="toggle-timeline-loop" style="margin-left:4px;"><div class="toggle-thumb"></div></div></div>
          <div class="timeline-toggle-label">Sync <div class="toggle on" id="toggle-timeline-sync" style="margin-left:4px;"><div class="toggle-thumb"></div></div></div>
        </div>
        <div class="timeline-lanes">
          <div class="timeline-lane selected" data-lane="azimuth">
            <span class="lane-label">Azimuth</span>
            <div class="lane-track"></div>
            <span class="curve-pill" id="lane-curve-azimuth">ease</span>
          </div>
          <div class="timeline-lane" data-lane="elevation">
            <span class="lane-label">Elevation</span>
            <div class="lane-track"></div>
            <span class="curve-pill" id="lane-curve-elevation">ease</span>
          </div>
          <div class="timeline-lane" data-lane="distance">
            <span class="lane-label">Distance</span>
            <div class="lane-track"></div>
            <span class="curve-pill" id="lane-curve-distance">ease</span>
          </div>
          <div class="timeline-lane" data-lane="size">
            <span class="lane-label">Size</span>
            <div class="lane-track"></div>
            <span class="curve-pill" id="lane-curve-size">step</span>
          </div>
        </div>
      </div>
    </div>

    <!-- RAIL -->
    <div class="rail" id="rail">

      <!-- CALIBRATE PANEL -->
      <div class="rail-panel" data-panel="calibrate">
        <div class="rail-mode-label">
          <span>Calibration</span>
          <span class="status-chip" id="cal-state-chip">Idle</span>
        </div>
        <div class="cal-chip-row">
          <span class="status-chip" id="cal-chip-topology">Topology: Stereo</span>
          <span class="status-chip" id="cal-chip-monitoring">Monitor: Speakers</span>
          <span class="status-chip" id="cal-chip-device">Device: Generic</span>
          <span class="status-chip" id="cal-chip-mapping">Mapping: 4/4</span>
        </div>
        <div class="calibrate-panel">
          <div class="cal-card">
            <div class="section">
              <div class="section-header">Profile Setup</div>
              <div class="control-row"><span class="control-label">Topology</span><select class="dropdown wide" id="cal-topology"><option>Mono</option><option selected>Stereo</option><option>Quad</option><option>5.1</option><option>7.1</option><option>7.1.2</option><option>7.4.2 / Atmos-style</option><option>Binaural / Headphone</option><option>Ambisonic 1st Order</option><option>Ambisonic 3rd Order</option><option>Multichannel -&gt; Stereo Downmix</option></select></div>
              <div class="control-row"><span class="control-label">Monitoring Path</span><select class="dropdown wide" id="cal-monitoring-path"><option selected>Speakers</option><option>Stereo Downmix</option><option>Steam Binaural</option><option>Virtual Binaural</option></select></div>
              <div class="control-row"><span class="control-label">Device Profile</span><select class="dropdown wide" id="cal-device-profile"><option selected>Generic</option><option>AirPods Pro 2</option><option>AirPods Pro 3</option><option>Sony WH-1000XM5</option><option>Custom SOFA</option></select></div>
              <div class="control-row"><span class="control-label">Mic Channel</span><select class="dropdown" id="cal-mic"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option></select></div>
            </div>
          </div>

          <div class="cal-card">
            <div class="section">
              <div class="section-header">Output Mapping</div>
              <div class="control-row"><span class="control-label">Legacy Config</span><select class="dropdown" id="cal-config"><option>4x Mono</option><option>2x Stereo</option></select></div>
              <div class="control-row"><span class="control-label">Routing</span><button class="btn-secondary" id="cal-redetect-btn">REDETECT</button></div>
              <div class="cal-mapping-matrix" id="cal-mapping-matrix"></div>
              <div class="cal-mapping-note" id="cal-mapping-note">Routing width ready.</div>
              <div class="cal-ack-row" id="cal-ack-redetect-row" style="display:none;">
                <span class="cal-ack-label">Allow redetect to overwrite custom map</span>
                <input class="cal-ack-check" type="checkbox" id="cal-ack-redetect-check" />
              </div>
              <div class="cal-ack-row" id="cal-ack-limited-row" style="display:none;">
                <span class="cal-ack-label">Allow limited mapping for current topology</span>
                <input class="cal-ack-check" type="checkbox" id="cal-ack-limited-check" />
              </div>
            </div>
          </div>

          <div class="cal-card">
            <div class="section">
              <div class="section-header">Run and Validation</div>
              <div class="control-row"><span class="control-label">Test Type</span><select class="dropdown" id="cal-type"><option>Sweep</option><option>Pink</option><option>White</option><option>Impulse</option></select></div>
              <div class="control-row"><span class="control-label">Test Level</span><span class="control-value" id="cal-level">-20.0 <span class="control-unit">dBFS</span></span></div>
              <div style="padding-top:8px;"><button class="btn-primary" id="cal-start-btn">START MEASURE</button></div>

              <div class="capture-meter" id="capture-meter" style="display:none;">
                <div class="capture-bar" id="capture-bar" style="height:0%;"></div>
                <span class="capture-label">Capturing...</span>
              </div>

              <div class="cal-validation-list">
                <article class="cal-diagnostic-card" id="cal-diagnostic-map-card" data-state="untested">
                  <div class="cal-diagnostic-header">
                    <span class="cal-diagnostic-label">Channel Map Contract</span>
                    <span class="status-chip untested" id="cal-validation-map-chip" data-state="untested">UNTESTED</span>
                  </div>
                  <div class="cal-diagnostic-detail" id="cal-validation-map-detail">Awaiting routing validation.</div>
                </article>
                <article class="cal-diagnostic-card" id="cal-diagnostic-phase-card" data-state="untested">
                  <div class="cal-diagnostic-header">
                    <span class="cal-diagnostic-label">Polarity and Phase</span>
                    <span class="status-chip untested" id="cal-validation-phase-chip" data-state="untested">UNTESTED</span>
                  </div>
                  <div class="cal-diagnostic-detail" id="cal-validation-phase-detail">Run calibration to evaluate polarity.</div>
                </article>
                <article class="cal-diagnostic-card" id="cal-diagnostic-delay-card" data-state="untested">
                  <div class="cal-diagnostic-header">
                    <span class="cal-diagnostic-label">Delay Consistency</span>
                    <span class="status-chip untested" id="cal-validation-delay-chip" data-state="untested">UNTESTED</span>
                  </div>
                  <div class="cal-diagnostic-detail" id="cal-validation-delay-detail">Run calibration to evaluate delay alignment.</div>
                </article>
                <article class="cal-diagnostic-card" id="cal-diagnostic-profile-card" data-state="untested">
                  <div class="cal-diagnostic-header">
                    <span class="cal-diagnostic-label">Profile Activation</span>
                    <span class="status-chip untested" id="cal-validation-profile-chip" data-state="untested">UNTESTED</span>
                  </div>
                  <div class="cal-diagnostic-detail" id="cal-validation-profile-detail">Monitoring mode not validated yet.</div>
                </article>
                <article class="cal-diagnostic-card" id="cal-diagnostic-downmix-card" data-state="untested">
                  <div class="cal-diagnostic-header">
                    <span class="cal-diagnostic-label">Downmix Path</span>
                    <span class="status-chip untested" id="cal-validation-downmix-chip" data-state="untested">UNTESTED</span>
                  </div>
                  <div class="cal-diagnostic-detail" id="cal-validation-downmix-detail">Downmix topology not requested.</div>
                </article>
              </div>

              <div style="padding-top:10px;" id="cal-status">
                <div class="status-row"><span class="status-dot" id="spk1-dot"></span><span class="status-text">SPK1: Not measured</span></div>
                <div class="status-row"><span class="status-dot" id="spk2-dot"></span><span class="status-text">SPK2: Not measured</span></div>
                <div class="status-row"><span class="status-dot" id="spk3-dot"></span><span class="status-text">SPK3: Not measured</span></div>
                <div class="status-row"><span class="status-dot" id="spk4-dot"></span><span class="status-text">SPK4: Not measured</span></div>
              </div>
            </div>
          </div>

          <div class="cal-card">
            <div class="section">
              <div class="section-header">Calibration Library</div>
              <div class="control-row cal-profile-name-row"><span class="control-label">Name</span><input class="text-input" id="cal-profile-name" placeholder="Profile name" value="" /></div>
              <div class="control-row"><span class="control-label">Profile</span><select class="dropdown wide" id="cal-profile-select"></select></div>
              <div class="cal-profile-actions">
                <button class="btn-secondary" id="cal-profile-save-btn">SAVE</button>
                <button class="btn-secondary" id="cal-profile-load-btn">LOAD</button>
                <button class="btn-secondary" id="cal-profile-rename-btn">RENAME</button>
                <button class="btn-secondary" id="cal-profile-delete-btn">DELETE</button>
              </div>
              <div class="cal-profile-status" id="cal-profile-status">No calibration profiles loaded.</div>
            </div>
          </div>

          <!-- Headphone Device Status (Task 14): populated from companion CalibrationProfile.json -->
          <div class="cal-card">
            <div class="section">
              <div class="section-header">Headphone Device Status</div>
              <div class="control-row"><span class="control-label">Active Device</span><span class="control-value mono" id="cal-hp-device">Not connected</span></div>
              <div class="control-row"><span class="control-label">EQ Mode</span><span class="control-value mono" id="cal-hp-eq-mode">Off</span></div>
              <div class="control-row"><span class="control-label">HRTF Mode</span><span class="control-value mono" id="cal-hp-hrtf-mode">Default HRTF</span></div>
              <div class="control-row"><span class="control-label">Head Tracking</span><span class="control-value mono" id="cal-hp-tracking">Disabled</span></div>
              <div class="control-row"><span class="control-label">FIR Latency</span><span class="control-value mono" id="cal-hp-fir-latency">0 smp</span></div>
              <div class="control-row"><span class="control-label">Externalization</span><span class="control-value mono" id="cal-hp-extern-score">--</span></div>
              <div class="control-row"><span class="control-label">Front/Back Score</span><span class="control-value mono" id="cal-hp-frontback-score">--</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- EMITTER PANEL -->
      <div class="rail-panel active" data-panel="emitter">
        <div class="rail-mode-label">
          <span>Emitter</span>
          <span class="status-chip local" id="emitter-authority-chip">Local</span>
        </div>
        <div class="motion-chip-row" id="motion-chip-row">
          <span class="status-chip" id="motion-chip-source">Source: Static</span>
          <span class="status-chip" id="motion-chip-loop">Loop: Off</span>
          <span class="status-chip active" id="motion-chip-sync">Sync: On</span>
          <span class="status-chip" id="motion-chip-dirty">Motion Saved</span>
        </div>
        <div class="emitter-authority-note" id="emitter-authority-note">Local emitter editing enabled</div>
        <div class="emitter-panel">
          <div class="emitter-card" data-emitter-group="identity">
            <div class="section">
              <div class="section-header">Emitter Identity</div>
              <div class="control-row"><span class="control-label">Label</span><input class="text-input emitter-inline-input" id="emit-label" value="Emitter" /></div>
              <div class="control-row"><span class="control-label">Color</span><span id="emit-color-swatch" style="width:16px; height:16px; border-radius:50%; background:#D4736F; cursor:pointer;"></span></div>
              <div class="control-row"><span class="control-label">Mute</span><div class="toggle" id="toggle-mute"><div class="toggle-thumb"></div></div></div>
              <div class="control-row"><span class="control-label">Solo</span><div class="toggle" id="toggle-solo"><div class="toggle-thumb"></div></div></div>
            </div>
          </div>

          <div class="emitter-card" data-emitter-group="position">
            <div class="section">
              <div class="section-header">Position</div>
              <div class="control-row"><span class="control-label">Mode</span><select class="dropdown" id="pos-mode"><option>Spherical</option><option>Cartesian</option></select></div>
              <div class="coord-group-caption">Spherical</div>
              <div class="control-row coord-row coord-row-spherical coord-active" data-coord-group="spherical"><span class="control-label">Azimuth</span><span class="control-value" id="val-azimuth">0.0<span class="control-unit">&deg;</span></span></div>
              <div class="control-row coord-row coord-row-spherical coord-active" data-coord-group="spherical"><span class="control-label">Elevation</span><span class="control-value" id="val-elevation">0.0<span class="control-unit">&deg;</span></span></div>
              <div class="control-row coord-row coord-row-spherical coord-active" data-coord-group="spherical"><span class="control-label">Distance</span><span class="control-value" id="val-distance">2.0<span class="control-unit">m</span></span></div>
              <div class="coord-group-caption">Cartesian</div>
              <div class="control-row coord-row coord-row-cartesian coord-inactive" data-coord-group="cartesian"><span class="control-label">X</span><span class="control-value" id="val-pos-x" data-stepper-lock="1">0.00<span class="control-unit">m</span></span></div>
              <div class="control-row coord-row coord-row-cartesian coord-inactive" data-coord-group="cartesian"><span class="control-label">Y</span><span class="control-value" id="val-pos-y" data-stepper-lock="1">0.00<span class="control-unit">m</span></span></div>
              <div class="control-row coord-row coord-row-cartesian coord-inactive" data-coord-group="cartesian"><span class="control-label">Z</span><span class="control-value" id="val-pos-z" data-stepper-lock="1">0.00<span class="control-unit">m</span></span></div>
              <div class="control-row position-readback-row"><span class="control-label">World</span><span class="control-value" id="val-world-readback">x 0.00  y 0.00  z 0.00 m</span></div>
            </div>
          </div>

          <div class="emitter-card" data-emitter-group="audio-shape">
            <div class="section">
              <div class="section-header">Audio Shape</div>
              <div class="control-row"><span class="control-label">Size Link</span><div class="toggle on" id="toggle-size-link"><div class="toggle-thumb"></div></div></div>
              <div class="control-row"><span class="control-label">Size Scale</span><span class="control-value" id="val-size">0.5<span class="control-unit">m</span></span></div>
              <div class="control-row"><span class="control-label">Gain</span><span class="control-value" id="val-gain">0.0<span class="control-unit">dB</span></span></div>
              <div class="control-row"><span class="control-label">Spread</span><span class="control-value" id="val-spread">0.0</span></div>
              <div class="control-row"><span class="control-label">Directivity</span><span class="control-value" id="val-directivity">0.5</span></div>
              <div class="control-row"><span class="control-label">Aim Azimuth</span><span class="control-value" id="val-dir-azimuth">0.0<span class="control-unit"></span></span></div>
              <div class="control-row"><span class="control-label">Aim Elevation</span><span class="control-value" id="val-dir-elevation">0.0<span class="control-unit"></span></span></div>
            </div>
          </div>

          <div class="emitter-card" data-emitter-group="motion">
            <div class="section">
              <div class="section-header">Motion</div>
              <div class="control-row"><span class="control-label">Motion Source</span><select class="dropdown wide" id="motion-source-select"><option value="static">Static</option><option value="physics">Physics</option><option value="timeline">Timeline</option><option value="choreography">Choreography</option></select></div>
              <div class="control-row"><span class="control-label">Audition Authority</span><span class="status-chip active" id="audition-authority-chip">Renderer</span></div>
              <div class="control-row"><span class="control-value" id="audition-authority-note">Renderer panel owns audition state.</span></div>
              <div class="control-row"><span class="control-label">Emitter Proxy</span><button class="btn-secondary" id="audition-proxy-emitter-btn">AUDITION THIS</button></div>
              <div class="motion-transport-strip" id="motion-transport-strip">
                <div class="timeline-transport">
                  <button class="transport-btn" id="motion-transport-rewind-btn" title="Rewind to start and pause">&#9664;</button>
                  <button class="transport-btn" id="motion-transport-stop-btn" title="Stop at current time">&#9632;</button>
                  <button class="transport-btn" id="motion-transport-play-btn" title="Play from current time">&#9654;</button>
                </div>
                <span class="timeline-time" id="motion-transport-time">00:00.000</span>
                <div class="timeline-toggle-label">Loop <div class="toggle" id="toggle-motion-loop" style="margin-left:4px;"><div class="toggle-thumb"></div></div></div>
                <div class="timeline-toggle-label">Sync <div class="toggle on" id="toggle-motion-sync" style="margin-left:4px;"><div class="toggle-thumb"></div></div></div>
                <div class="motion-speed-block">
                  <span class="motion-speed-label">Speed</span>
                  <span class="control-value motion-speed-value" id="val-anim-speed">1.0<span class="control-unit">x</span></span>
                </div>
              </div>
              <div class="motion-subsection active" id="motion-panel-physics" data-motion-panel="physics">
                <div class="motion-subsection-title">
                  <span>Physics</span>
                  <select class="dropdown wide" id="physics-preset">
                    <option value="off">Off</option>
                    <option value="bounce">Bounce</option>
                    <option value="float">Float</option>
                    <option value="orbit">Orbit</option>
                    <option value="custom">Custom</option>
                  </select>
                </div>
                <div class="control-row"><span class="control-label">Proxy</span><button class="btn-secondary" id="audition-proxy-physics-btn">AUDITION PHYSICS</button></div>
                <div id="physics-active" style="display:none;">
                  <div class="control-row"><span class="control-label">Intensity</span><span class="control-value">0.5</span></div>
                  <div class="btn-row">
                    <button class="btn-secondary" id="btn-throw">THROW</button>
                    <button class="btn-secondary" id="btn-reset">RESET</button>
                  </div>
                  <div class="disclosure" id="physics-disclosure">
                    <span class="disclosure-arrow" id="physics-arrow">&#9654;</span>
                    Advanced
                  </div>
                  <div class="disclosure-content" id="physics-advanced">
                    <div class="control-row"><span class="control-label">Mass</span><span class="control-value" id="val-mass">1.0<span class="control-unit">kg</span></span></div>
                    <div class="control-row"><span class="control-label">Drag</span><span class="control-value" id="val-drag">0.5</span></div>
                    <div class="control-row"><span class="control-label">Elasticity</span><span class="control-value" id="val-elasticity">0.7</span></div>
                    <div class="control-row"><span class="control-label">Gravity</span><span class="control-value" id="val-gravity">0.0<span class="control-unit">m/s&sup2;</span></span></div>
                    <div class="control-row"><span class="control-label">Friction</span><span class="control-value" id="val-friction">0.3</span></div>
                    <div class="control-row"><span class="control-label">Direction</span><select class="dropdown" id="phys-grav-dir"><option>Down</option><option>Up</option><option>Center</option><option>From Center</option><option>Custom</option></select></div>
                    <div class="control-row"><span class="control-label">Init Vel X</span><span class="control-value" id="val-vel-x">0.0<span class="control-unit">m/s</span></span></div>
                    <div class="control-row"><span class="control-label">Init Vel Y</span><span class="control-value" id="val-vel-y">0.0<span class="control-unit">m/s</span></span></div>
                    <div class="control-row"><span class="control-label">Init Vel Z</span><span class="control-value" id="val-vel-z">0.0<span class="control-unit">m/s</span></span></div>
                  </div>
                </div>
              </div>

              <div class="motion-subsection inactive" id="motion-panel-timeline" data-motion-panel="timeline">
                <div class="motion-subsection-title">
                  <span>Timeline</span>
                </div>
                <div id="anim-controls" style="opacity:0.4;">
                  <div class="control-row"><span class="control-label">Source</span><select class="dropdown" id="anim-source" disabled><option>DAW</option><option>Internal</option></select></div>
                </div>
              </div>

              <div class="motion-subsection inactive" id="motion-panel-choreography" data-motion-panel="choreography">
                <div class="motion-subsection-title">
                  <span>Choreography</span>
                </div>
                <div class="control-row"><span class="control-label">Proxy</span><button class="btn-secondary" id="audition-proxy-choreography-btn">AUDITION CHOREO</button></div>
                <div class="control-row">
                  <span class="control-label">Pack</span>
                  <select class="dropdown wide" id="choreo-pack-select">
                    <option value="custom">Custom</option>
                    <option value="orbit">Orbit</option>
                    <option value="pendulum">Pendulum</option>
                    <option value="swarm_arc">Swarm Arc</option>
                    <option value="rise_fall">Rise/Fall</option>
                  </select>
                </div>
                <div class="btn-row">
                  <button class="btn-secondary" id="choreo-apply-btn">APPLY</button>
                  <button class="btn-secondary" id="choreo-save-btn">SAVE PACK</button>
                </div>
                <div class="control-row">
                  <span class="control-value" id="choreo-status">Pack ready</span>
                </div>
              </div>
            </div>
          </div>

          <div class="emitter-card" data-emitter-group="presets">
            <div class="section">
              <div class="section-header">Presets</div>
              <div class="control-row">
                <span class="control-label">Type</span>
                <select class="dropdown wide" id="preset-type-select">
                  <option value="emitter">Emitter Preset</option>
                  <option value="motion">Motion Preset</option>
                </select>
              </div>
              <div class="control-row">
                <span class="control-label">Name</span>
                <input class="text-input emitter-inline-input" id="preset-name-input" placeholder="Preset name" value="" />
              </div>
              <div class="control-row">
                <span class="control-label">Preset</span>
                <select class="dropdown wide" id="preset-select"></select>
              </div>
              <div class="btn-row">
                <button class="btn-secondary" id="preset-save-btn">SAVE</button>
                <button class="btn-secondary" id="preset-load-btn">LOAD</button>
              </div>
              <div class="btn-row">
                <button class="btn-secondary" id="preset-rename-btn">RENAME</button>
                <button class="btn-secondary" id="preset-delete-btn">DELETE</button>
              </div>
              <div class="control-row">
                <span class="control-value" id="preset-status">No presets loaded</span>
              </div>
            </div>
          </div>

          <div class="emitter-card" data-emitter-group="diagnostics">
            <div class="section">
              <div class="section-header emitter-diagnostics-toggle" id="emitter-diagnostics-toggle">
                <span>Diagnostics</span>
                <span class="disclosure-arrow" id="emitter-diagnostics-arrow">&#9654;</span>
              </div>
              <div class="emitter-diagnostics-content" id="emitter-diagnostics-content">
                <div class="control-row"><span class="control-label">Physics Lens</span><div class="toggle" id="emitter-quick-physics-lens"><div class="toggle-thumb"></div></div></div>
                <div class="control-row"><span class="control-label">Diagnostic Mix</span><span class="control-value" id="emitter-quick-diag-mix">55<span class="control-unit">%</span></span></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RENDERER PANEL -->
      <div class="rail-panel" data-panel="renderer">
        <div class="rail-mode-label">
          <span>Renderer</span>
          <span class="status-chip neutral" id="rend-chip-panel-state">Awaiting Payload</span>
        </div>
        <div class="renderer-chip-row">
          <span class="status-chip neutral" id="rend-chip-profile-req">Req: Auto</span>
          <span class="status-chip neutral" id="rend-chip-profile-active">Active: Auto</span>
          <span class="status-chip neutral" id="rend-chip-profile-stage">Stage: Direct</span>
          <span class="status-chip neutral" id="rend-chip-output">Out: 2ch Stereo</span>
        </div>
        <div class="renderer-fallback-note warning" id="rend-fallback-note">Awaiting renderer payload from scene-state bridge.</div>
        <div class="renderer-panel">
          <div class="renderer-card" data-renderer-group="profile-authority">
            <div class="section">
              <div class="section-header">Profile Authority</div>
              <div class="renderer-profile-grid">
                <div class="renderer-profile-line"><span class="renderer-profile-label">Requested</span><span class="renderer-profile-value" id="rend-profile-requested">Auto</span></div>
                <div class="renderer-profile-line"><span class="renderer-profile-label">Active</span><span class="renderer-profile-value" id="rend-profile-active">Auto</span></div>
                <div class="renderer-profile-line"><span class="renderer-profile-label">Stage</span><span class="renderer-profile-value" id="rend-profile-stage">Direct</span></div>
                <div class="renderer-profile-line"><span class="renderer-profile-label">Output Route</span><span class="renderer-profile-value" id="rend-output-route">L/R</span></div>
              </div>
              <div class="renderer-output-summary" id="rend-output-summary">Renderer payload unavailable. Showing fallback-safe control defaults.</div>
            </div>
          </div>

          <div class="renderer-card" data-renderer-group="output">
            <div class="section">
              <div class="section-header">Output and Speakers</div>
              <div class="control-row"><span class="control-label">Master Gain</span><span class="control-value" id="val-master-gain">0.0<span class="control-unit">dB</span></span></div>
              <div class="control-row"><span class="control-label">Map</span><span class="control-value" id="rend-speaker-map">Stereo  L/R</span></div>
              <div class="control-row"><span class="control-label">SPK1</span><span class="control-value" id="rend-spk1-value">0.0<span class="control-unit">dB</span>  0.0<span class="control-unit">ms</span></span></div>
              <div class="control-row"><span class="control-label">SPK2</span><span class="control-value" id="rend-spk2-value">0.0<span class="control-unit">dB</span>  0.0<span class="control-unit">ms</span></span></div>
              <div class="control-row"><span class="control-label">SPK3</span><span class="control-value" id="rend-spk3-value">0.0<span class="control-unit">dB</span>  0.0<span class="control-unit">ms</span></span></div>
              <div class="control-row"><span class="control-label">SPK4</span><span class="control-value" id="rend-spk4-value">0.0<span class="control-unit">dB</span>  0.0<span class="control-unit">ms</span></span></div>
            </div>
          </div>

          <div class="renderer-card" data-renderer-group="spatialization">
            <div class="section">
              <div class="section-header">Spatialization</div>
              <div class="control-row"><span class="control-label">Distance</span><select class="dropdown" id="rend-dist-model"><option>Inverse&sup2;</option><option>Linear</option><option>Log</option><option>Custom</option></select></div>
              <div class="control-row"><span class="control-label">Headphone</span><select class="dropdown" id="rend-headphone-mode"><option>Stereo Downmix</option><option>Steam Binaural</option></select></div>
              <div class="control-row"><span class="control-label">HP Profile</span><select class="dropdown" id="rend-headphone-profile"><option>Generic</option><option>AirPods Pro 2</option><option>AirPods Pro 3</option><option>Sony WH-1000XM5</option><option>Custom SOFA</option></select></div>
              <div class="control-row"><span class="control-label">Ref Dist</span><span class="control-value">1.0<span class="control-unit">m</span></span></div>
              <div class="control-row"><span class="control-label">Doppler</span><div class="toggle" id="toggle-doppler"><div class="toggle-thumb"></div></div></div>
              <div class="control-row"><span class="control-label">Air Absorb</span><div class="toggle on" id="toggle-air-absorb"><div class="toggle-thumb"></div></div></div>
            </div>
          </div>

          <div class="renderer-card" data-renderer-group="audition">
            <div class="section">
              <div class="section-header">Audition Source</div>
              <div class="control-row"><span class="control-label">Enable</span><div class="toggle" id="toggle-audition"><div class="toggle-thumb"></div></div></div>
              <div class="control-row"><span class="control-label">Signal</span><select class="dropdown" id="rend-audition-signal"><option>Sine 440</option><option>Dual Tone</option><option>Pink Noise</option><option>Rain</option><option>Snow</option><option>Bouncing Balls</option><option>Wind Chimes</option><option>Crickets</option><option>Song Birds</option><option>Karplus Plucks</option><option>Membrane Drops</option><option>Krell Patch</option><option>Generative Arp</option></select></div>
              <div class="control-row"><span class="control-label">Motion</span><select class="dropdown" id="rend-audition-motion"><option>Center</option><option>Orbit Slow</option><option>Orbit Fast</option><option>Figure8 Flow</option><option>Helix Rise</option><option>Wall Ricochet</option></select></div>
              <div class="control-row"><span class="control-label">Level</span><select class="dropdown" id="rend-audition-level"><option>-36 dBFS</option><option>-30 dBFS</option><option>-24 dBFS</option><option>-18 dBFS</option><option>-12 dBFS</option></select></div>
            </div>
          </div>

          <div class="renderer-card" data-renderer-group="room">
            <div class="section">
              <div class="section-header">Room Acoustics</div>
              <div class="control-row"><span class="control-label">Enable</span><div class="toggle on" id="toggle-room"><div class="toggle-thumb"></div></div></div>
              <div class="control-row"><span class="control-label">Mix</span><span class="control-value">0.3</span></div>
              <div class="control-row"><span class="control-label">Size</span><span class="control-value">1.0<span class="control-unit">x</span></span></div>
              <div class="control-row"><span class="control-label">Damping</span><span class="control-value">0.5</span></div>
              <div class="control-row"><span class="control-label">ER Only</span><div class="toggle" id="toggle-er-only"><div class="toggle-thumb"></div></div></div>
            </div>
          </div>

          <div class="renderer-card" data-renderer-group="diagnostics">
            <div class="section">
              <div class="section-header">Diagnostics</div>
              <div class="renderer-diagnostic-list">
                <article class="renderer-diagnostic-card headtracking" id="rend-headtrack-card">
                  <div class="renderer-diagnostic-header">
                    <span class="renderer-diagnostic-label">Head Tracking</span>
                    <span class="status-chip neutral" id="rend-headtrack-chip">OFF</span>
                  </div>
                  <div class="renderer-diagnostic-detail" id="rend-headtrack-detail">Bridge disabled in this build.</div>
                  <div class="renderer-diagnostic-content open" id="rend-headtrack-content">
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Source</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-headtrack-source">disabled</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Seq</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-headtrack-seq">0</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Timestamp</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-headtrack-timestamp">0 ms</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Age</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-headtrack-age">n/a</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Yaw/Pitch/Roll</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-headtrack-euler">0.0 / 0.0 / 0.0 deg</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Quaternion</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-headtrack-quat">0.0000, 0.0000, 0.0000, 1.0000</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Invalid Packets</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-headtrack-invalid">0</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Bridge Consumers</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-headtrack-consumers">0</span>
                    </div>
                    <div class="renderer-diagnostic-field" id="rend-headtrack-recenter-row">
                      <span class="renderer-diagnostic-field-label">Re-center</span>
                      <span class="renderer-diagnostic-field-value" style="display:flex;align-items:center;gap:8px;">
                        <button id="rend-headtrack-set-forward" class="btn-secondary" style="padding:2px 8px;font-size:11px;" disabled>Set Forward</button>
                        <span id="rend-headtrack-drift" class="mono" style="font-size:11px;">Drift: n/a</span>
                      </span>
                    </div>
                  </div>
                </article>
                <article class="renderer-diagnostic-card" id="rend-resize-card">
                  <div class="renderer-diagnostic-header">
                    <button class="renderer-diagnostic-toggle" id="rend-resize-toggle" aria-expanded="false" aria-controls="rend-resize-content">
                      <span class="renderer-diagnostic-label">Resize / DPI</span>
                      <span class="disclosure-arrow" id="rend-resize-arrow">&#9654;</span>
                    </button>
                    <span class="status-chip neutral" id="rend-resize-chip">UNKNOWN</span>
                  </div>
                  <div class="renderer-diagnostic-detail" id="rend-resize-detail">Awaiting resize diagnostics.</div>
                  <div class="renderer-diagnostic-content" id="rend-resize-content" hidden>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Viewport (W x H)</span>
                      <span class="renderer-diagnostic-field-value" id="rend-resize-viewport">unknown</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Device Pixel Ratio</span>
                      <span class="renderer-diagnostic-field-value" id="rend-resize-dpr">unknown</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Layout Bucket</span>
                      <span class="renderer-diagnostic-field-value" id="rend-resize-bucket">unknown</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Last Resize Settle</span>
                      <span class="renderer-diagnostic-field-value" id="rend-resize-settle">unknown</span>
                    </div>
                  </div>
                </article>
                <article class="renderer-diagnostic-card" id="rend-auth-card">
                  <div class="renderer-diagnostic-header">
                    <button class="renderer-diagnostic-toggle" id="rend-auth-toggle" aria-expanded="false" aria-controls="rend-auth-content">
                      <span class="renderer-diagnostic-label">Authority Status</span>
                      <span class="disclosure-arrow" id="rend-auth-arrow">&#9654;</span>
                    </button>
                    <span class="status-chip neutral" id="rend-auth-chip">UNAVAILABLE</span>
                  </div>
                  <div class="renderer-diagnostic-detail" id="rend-auth-detail">Awaiting authority diagnostics payload.</div>
                  <div class="renderer-diagnostic-content" id="rend-auth-content" hidden>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Source</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-auth-source">native fallback</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Status Class</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-auth-status-class">authority unavailable</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Lock Reason</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-auth-lock-reason">none</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Snapshot Age</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-auth-snapshot-age">0 ms</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Fallback Reason</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-auth-fallback-reason">none</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Replay Seq</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-auth-replay-seq">0</span>
                    </div>
                  </div>
                </article>
                <article class="renderer-diagnostic-card" id="rend-hpver-card">
                  <div class="renderer-diagnostic-header">
                    <button class="renderer-diagnostic-toggle" id="rend-hpver-toggle" aria-expanded="false" aria-controls="rend-hpver-content">
                      <span class="renderer-diagnostic-label">Headphone Verification</span>
                      <span class="disclosure-arrow" id="rend-hpver-arrow">&#9654;</span>
                    </button>
                    <span class="status-chip neutral" id="rend-hpver-chip">UNAVAILABLE</span>
                  </div>
                  <div class="renderer-diagnostic-detail" id="rend-hpver-detail">Awaiting headphone verification diagnostics payload.</div>
                  <div class="renderer-diagnostic-content" id="rend-hpver-content" hidden>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Catalog Version</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-catalog">Unavailable</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Profile Route</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-profile-route">Unavailable</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Fallback Reason</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-fallback-reason">none</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Fallback Target</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-fallback-target">none</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Custom SOFA Ref</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-custom-sofa">none</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Calibration Route</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-calibration-route">Unavailable</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Calibration Stage</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-calibration-stage">Unavailable</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Calibration Engine</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-calibration-engine">Unavailable</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Calibration Fallback</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-calibration-fallback">Unavailable</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Verification Schema</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-schema">Unavailable</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Verification Stage</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-stage">Unavailable</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Score Status</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-score-status">Unavailable</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Scores (0..1)</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-scores">FB n/a  EL n/a  EXT n/a</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Confidence</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-confidence">n/a</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Latency Samples</span>
                      <span class="renderer-diagnostic-field-value mono" id="rend-hpver-latency">n/a</span>
                    </div>
                  </div>
                </article>
                <article class="renderer-diagnostic-card" id="rend-steam-card">
                  <div class="renderer-diagnostic-header">
                    <button class="renderer-diagnostic-toggle" id="rend-steam-toggle" aria-expanded="false" aria-controls="rend-steam-content">
                      <span class="renderer-diagnostic-label">Steam Audio</span>
                      <span class="disclosure-arrow" id="rend-steam-arrow">&#9654;</span>
                    </button>
                    <span class="status-chip neutral" id="rend-steam-chip">UNAVAILABLE</span>
                  </div>
                  <div class="renderer-diagnostic-detail" id="rend-steam-detail">Awaiting Steam diagnostics payload.</div>
                  <div class="renderer-diagnostic-content" id="rend-steam-content" hidden>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">HRTF</span>
                      <span class="renderer-diagnostic-field-value" id="rend-steam-hrtf-status">Unknown</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Binaural Tier</span>
                      <span class="renderer-diagnostic-field-value" id="rend-steam-binaural-tier">Unknown</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Reflections</span>
                      <span class="renderer-diagnostic-field-value" id="rend-steam-reflections-state">Unknown</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Convolution</span>
                      <span class="renderer-diagnostic-field-value" id="rend-steam-convolution-method">Unknown</span>
                    </div>
                    <div class="renderer-diagnostic-field" id="rend-steam-last-error-row">
                      <span class="renderer-diagnostic-field-label">Last Error</span>
                      <span class="renderer-diagnostic-field-value" id="rend-steam-last-error">None</span>
                    </div>
                  </div>
                </article>
                <article class="renderer-diagnostic-card" id="rend-ambi-card">
                  <div class="renderer-diagnostic-header">
                    <button class="renderer-diagnostic-toggle" id="rend-ambi-toggle" aria-expanded="false" aria-controls="rend-ambi-content">
                      <span class="renderer-diagnostic-label">Ambisonic</span>
                      <span class="disclosure-arrow" id="rend-ambi-arrow">&#9654;</span>
                    </button>
                    <span class="status-chip neutral" id="rend-ambi-chip">UNAVAILABLE</span>
                  </div>
                  <div class="renderer-diagnostic-detail" id="rend-ambi-detail">Awaiting ambisonic diagnostics payload.</div>
                  <div class="renderer-diagnostic-content" id="rend-ambi-content" hidden>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Order</span>
                      <span class="renderer-diagnostic-field-value" id="rend-ambi-order">Unknown</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Channel Count</span>
                      <span class="renderer-diagnostic-field-value" id="rend-ambi-channel-count">Unknown</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Decoder State</span>
                      <span class="renderer-diagnostic-field-value" id="rend-ambi-decoder-state">Unknown</span>
                    </div>
                    <div class="renderer-diagnostic-field">
                      <span class="renderer-diagnostic-field-label">Decoder Type</span>
                      <span class="renderer-diagnostic-field-value" id="rend-ambi-decoder-type">Unknown</span>
                    </div>
                  </div>
                </article>
              </div>
              <div class="renderer-output-summary" id="rend-diagnostics-availability">Bridge diagnostics unavailable; controls remain writable with fallback-safe defaults.</div>
            </div>
          </div>

          <div class="renderer-card" data-renderer-group="physics">
            <div class="section">
              <div class="section-header">Physics (Global)</div>
              <div class="control-row"><span class="control-label">Rate</span><select class="dropdown" id="rend-phys-rate"><option>30 Hz</option><option selected>60 Hz</option><option>120 Hz</option><option>240 Hz</option></select></div>
              <div class="control-row"><span class="control-label">Walls</span><div class="toggle on" id="toggle-walls"><div class="toggle-thumb"></div></div></div>
              <div class="control-row"><span class="control-label">Object Interaction</span><div class="toggle" id="toggle-interact"><div class="toggle-thumb"></div></div></div>
              <div style="padding-top:8px;"><button class="btn-secondary" style="width:100%;" id="btn-pause-physics">PAUSE ALL</button></div>
            </div>
          </div>

          <div class="renderer-card" data-renderer-group="telemetry">
            <div class="section">
              <div class="section-header">Viewport Telemetry</div>
              <div class="control-row"><span class="control-label">Trails</span><div class="toggle on" id="toggle-viz-trails"><div class="toggle-thumb"></div></div></div>
              <div class="control-row"><span class="control-label">Trail Len</span><span class="control-value" id="val-viz-trail-len">5.0<span class="control-unit">s</span></span></div>
              <div class="control-row"><span class="control-label">Velocity Vectors</span><div class="toggle" id="toggle-viz-vectors"><div class="toggle-thumb"></div></div></div>
              <div class="control-row"><span class="control-label">Physics Lens</span><div class="toggle" id="toggle-viz-physics-lens"><div class="toggle-thumb"></div></div></div>
              <div class="control-row"><span class="control-label">Diagnostic Mix</span><span class="control-value" id="val-viz-diag-mix">55<span class="control-unit">%</span></span></div>
            </div>
          </div>

          <div class="renderer-card" data-renderer-group="scene">
            <div class="section">
              <div class="section-header">Scene Monitor</div>
              <div id="scene-list"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>
